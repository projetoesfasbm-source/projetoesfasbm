{% extends "base.html" %}

{% block title %}Boletim Atitudinal{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Boletim de Avaliação Atitudinal</h2>
        <div>
            <a href="{{ url_for('justica.fada_boletim', print='true') }}" target="_blank" class="btn btn-primary">
                <i class="fas fa-print me-1"></i> Imprimir Boletim Oficial
            </a>
            <a href="{{ url_for('justica.index') }}" class="btn btn-outline-secondary ms-2">Voltar</a>
        </div>
    </div>

    <div class="card mb-4 shadow-sm no-print">
        <div class="card-body py-2">
            <form method="GET" class="row align-items-center">
                <div class="col-auto"><label class="fw-bold">Filtrar Turma:</label></div>
                <div class="col-auto">
                    <select name="turma_id" class="form-select form-select-sm" onchange="this.form.submit()">
                        <option value="">Todas</option>
                        {% for t in turmas %}
                        <option value="{{ t.id }}" {% if request.args.get('turma_id')|int == t.id %}selected{% endif %}>{{ t.nome }}</option>
                        {% endfor %}
                    </select>
                </div>
            </form>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="table-responsive">
            <table class="table table-hover table-bordered mb-0 align-middle">
                <thead class="bg-light text-center">
                    <tr>
                        <th rowspan="2" class="align-middle">Nº</th>
                        <th rowspan="2" class="align-middle text-start">Aluno</th>
                        <th colspan="3">Notas (Conforme Regulamento)</th>
                        <th rowspan="2" class="align-middle" style="width: 100px;">Status</th>
                    </tr>
                    <tr>
                        <th class="text-primary">NDisc (Base 20)</th>
                        <th class="text-success">FADA (Base 8)</th>
                        <th class="table-dark">AAt Final</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in dados %}
                    <tr class="text-center">
                        <td>{{ item.aluno.num_aluno or '-' }}</td>
                        <td class="text-start">
                            <strong>{{ item.aluno.user.posto_graduacao }} {{ item.aluno.user.nome_completo }}</strong><br>
                            <small class="text-muted">{{ item.turma }}</small>
                        </td>
                        <td class="fw-bold text-primary">{{ "{:.2f}".format(item.ndisc) }}</td>
                        
                        <td class="fw-bold text-success">{{ "{:.2f}".format(item.fada) }}</td>
                        
                        <td class="bg-light fw-bold fs-5">{{ "{:.2f}".format(item.aat) }}</td>
                        
                        <td>
                            {% if item.aat >= 7.0 %}
                                <span class="badge bg-success">Apto</span>
                            {% elif item.aat >= 5.0 %}
                                <span class="badge bg-warning text-dark">Recuperação</span>
                            {% else %}
                                <span class="badge bg-danger">Inapto</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="6" class="text-center py-4">Nenhum aluno encontrado para os critérios selecionados.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="alert alert-light mt-3 border">
        <strong>Legenda:</strong><br>
        <small><strong>NDisc:</strong> Nota Disciplinar (Base 20 - Pontos Perdidos) / 2. (Considera infrações a partir do 2º Ciclo).</small><br>
        <small><strong>FADA:</strong> Ficha de Avaliação (Base 8.0 - Punições + Elogios). (Pode ser editada individualmente ou calculada automaticamente).</small><br>
        <small><strong>AAt:</strong> Avaliação Atitudinal Final = (NDisc + FADA) / 2.</small>
    </div>
</div>
{% endblock %}